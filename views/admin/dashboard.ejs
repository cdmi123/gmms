<%- include('../partials/admin-header') %>

<div class="admin-wrapper">
    <%- include('../partials/admin-sidebar') %>
    
    <div class="admin-main-content">
        <!-- Top Navbar -->
        <nav class="admin-navbar">
            <div class="navbar-left">
                <button class="sidebar-toggle d-lg-none" onclick="toggleSidebar()">
                    <i class="bi bi-list"></i>
                </button>
                <button class="sidebar-toggle d-none d-lg-block" onclick="toggleDesktopSidebar()">
                    <i class="bi bi-list"></i>
                </button>
                <h5 class="navbar-title d-none d-md-block">Dashboard</h5>
            </div>
            
            <div class="navbar-right">
                <div class="navbar-date">
                    <i class="bi bi-calendar3"></i>
                    <span><%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></span>
                </div>
                <div class="navbar-user">
                    <div class="user-avatar" data-bs-toggle="dropdown">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    <div class="user-dropdown">
                        <a href="#" class="dropdown-item">
                            <i class="bi bi-person"></i>
                            <span>Profile</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="/admin/logout" class="dropdown-item danger">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                    <div>
                        <h1 class="page-title">Overview</h1>
                        <p class="page-subtitle">System performance and active member metrics</p>
                    </div>
                    <div class="page-actions">
                        <a href="/admin/rounds" class="btn btn-primary">
                            <i class="bi bi-wallet2 me-2"></i>
                            Manage Rounds
                        </a>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card fade-in">
                    <div class="stat-icon">
                        <i class="bi bi-people-fill"></i>
                    </div>
                    <div class="stat-label">Active Members</div>
                    <div class="stat-value"><%= stats.memberCount %></div>
                    <div class="stat-description">Total active users</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.1s">
                    <div class="stat-icon" style="background: #fef3c7; color: #f59e0b;">
                        <i class="bi bi-hourglass-split"></i>
                    </div>
                    <div class="stat-label">Pending Collections</div>
                    <div class="stat-value"><%= stats.pendingPaymentsCount %></div>
                    <div class="stat-description">Current round status</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.2s">
                    <div class="stat-icon" style="background: #d1fae5; color: #10b981;">
                        <i class="bi bi-dice-5-fill"></i>
                    </div>
                    <div class="stat-label">Total Draws</div>
                    <div class="stat-value"><%= stats.totalDrawsCompleted %></div>
                    <div class="stat-description">Historical luck draws</div>
                </div>

                <div class="stat-card fade-in" style="animation-delay: 0.3s">
                    <div class="stat-icon" style="background: #dbeafe; color: #2563eb;">
                        <i class="bi bi-currency-rupee"></i>
                    </div>
                    <div class="stat-label">Total Collected</div>
                    <div class="stat-value">₹<%= (stats.totalPaidAmount || 0).toLocaleString() %></div>
                    <div class="stat-description">Overall collection</div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="row g-4">
                <!-- Active Round Overview -->
                <div class="col-lg-7">
                    <div class="admin-card fade-in">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-wallet2"></i>
                                Active Round Overview
                            </h5>
                            <a href="/admin/rounds" class="btn btn-sm btn-secondary">
                                View All
                                <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                        
                        <% if (activeRound) { %>
                            <div class="mb-3 p-3 bg-secondary rounded-lg">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge badge-primary mb-2">Round <%= activeRound.roundNumber %></span>
                                        <div class="fw-bold text-primary">₹<%= activeRound.totalCollection.toLocaleString() %></div>
                                        <small class="text-muted">Target Collection</small>
                                    </div>
                                    <div class="text-end">
                                        <div class="fw-bold">₹<%= stats.currentRoundCollected.toLocaleString() %></div>
                                        <small class="text-muted">Collected</small>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        
                        <div class="table-responsive">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Member Name</th>
                                        <th class="d-none d-md-table-cell">Member ID</th>
                                        <th class="text-center">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (membersOverview && membersOverview.length > 0) { %>
                                        <% membersOverview.slice(0, 10).forEach(p => { %>
                                            <tr>
                                                <td class="fw-bold">
                                                    <%= p.memberId ? p.memberId.name : 'Deleted Member' %>
                                                </td>
                                                <td class="text-muted small d-none d-md-table-cell">
                                                    ID-<%= p.memberId ? p.memberId._id.toString().slice(-5) : 'N/A' %>
                                                </td>
                                                <td class="text-center">
                                                    <span class="badge <%= p.status === 'paid' ? 'badge-success' : 'badge-warning' %>">
                                                        <%= p.status.toUpperCase() %>
                                                    </span>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="3" class="text-center py-5">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon">
                                                        <i class="bi bi-inbox"></i>
                                                    </div>
                                                    <div class="empty-state-title">No data available</div>
                                                    <div class="empty-state-text">No members in current round</div>
                                                </div>
                                            </td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Winners -->
                <div class="col-lg-5">
                    <div class="admin-card fade-in">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-trophy-fill"></i>
                                Recent Winners
                            </h5>
                        </div>
                        
                        <% if (recentDraws && recentDraws.length > 0) { %>
                            <div class="d-flex flex-column gap-3">
                                <% recentDraws.slice(0, 5).forEach((draw, index) => { %>
                                    <% if (draw && draw.winnerId) { %>
                                        <div class="d-flex justify-content-between align-items-center p-3 rounded-lg bg-secondary">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="stat-icon" style="width: 48px; height: 48px; background: #fef3c7; color: #f59e0b; margin: 0;">
                                                    <i class="bi bi-trophy-fill"></i>
                                                </div>
                                                <div>
                                                    <div class="fw-bold">
                                                        <%= draw.winnerId.name %>
                                                    </div>
                                                    <div class="text-muted small">
                                                        <i class="bi bi-calendar2-event me-1"></i>
                                                        <%= draw.drawDate ? new Date(draw.drawDate).toLocaleDateString() : 'Unknown Date' %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-end">
                                                <div class="fw-bold text-primary">
                                                    <%= draw.goldWeight || 0 %>g
                                                </div>
                                                <small class="text-muted">Gold</small>
                                            </div>
                                        </div>
                                    <% } %>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="bi bi-trophy"></i>
                                </div>
                                <div class="empty-state-title">No recent winners</div>
                                <div class="empty-state-text">Start a lucky draw to see winners here</div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/admin-footer') %>
